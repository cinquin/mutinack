#!/bin/bash
set -o pipefail
set -e
if [ `uname` == FreeBSD ]; then
	(nohup java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=6606 -Djavax.net.ssl.trustStore=mutinack_public_trustStore -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.keyStore=mutinack_public_selfsigned.jks -Djavax.net.ssl.keyStorePassword=passphrase -cp mutinack.jar:nailgun/nailgun-server/target/nailgun-server-0.9.2-SNAPSHOT-jar-with-dependencies.jar com.martiansoftware.nailgun.NGServer &> run_nailgun_server_out) &
	echo $!
else
	java -Djavax.net.ssl.trustStore=mutinack_public_trustStore -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.keyStore=mutinack_public_selfsigned.jks -Djavax.net.ssl.keyStorePassword=passphrase -cp mutinack.jar:nailgun/nailgun-server/target/nailgun-server-0.9.2-SNAPSHOT-jar-with-dependencies.jar com.martiansoftware.nailgun.NGServer --daemon | sed -n '/PID=.*/p;//! w run_nailgun_server_out' | sed -e 's/PID=//'
fi
